<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <style>
    body {
      padding: 100px;
      width: 1000px;
      margin: auto;
      text-align: left;
      font-weight: 300;
      font-family: 'Open Sans', sans-serif;
      color: #121212;
    }

    h1,
    h2,
    h3,
    h4 {
      font-family: 'Source Sans Pro', sans-serif;
    }
  </style>
  <title>CS 184 Cloth Sim</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Sans+Pro" rel="stylesheet">
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>


<body>

	<h1 align="middle">CS 284A: Computer Graphics and Imaging, Spring 2023</h1>
	<h1 align="middle">Project 4: Cloth Sim</h1>
	<h2 align="middle">Chaomin Li (zhaominl@berkeley.edu)</h2>
	<h2 align="middle">Zhiqi Yan (zhiqiyan@berkeley.edu)</h2>

	<br><br>

	<div>

	<h2 align="middle">Overview</h2>

	<p>
      In this project, we build a Cloth Simulator. We went from constructing the mass and spring system to simulating the point mass positions using numerical integration, 
      and from shpere/plane collision to self collision. Finally, we implemented various shading and mapping effects using GLSL. These techniques helped us render the cloth 
      with many realistic effects.

  </p>
  <br />

  <h2 align="middle">Part 1: Masses and Springs</h2>

  <h2 align="middle">Part 2: Simulation via Numerical Integration</h2>

  <h2 align="middle">Part 3: Handling collisions with other objects</h2>

  <p>
    <b>
      Implementation
    </b>
  </p>
  <p>
    To handle collision with other primitives, we simply check if any point mass is inside any primitives. If so, we bounce back simulated path to adjust 
    its position to places outside of the primitives using a correction vector. The correction vector is the vector from last position of the point mass to
    a tangent point. For a sphere, a tangent point can be the point just outside the phere and on the line formed by the position of the point mass and the
    center of the sphere. For a plane, a tangent point can be the point just above the plane and on the line formed by extending the plane normal from the
    position of the point mass. In addition, the correction vector is scaled down by a friction term. \n
    
    After implementing these in Sphere::collide and Plane::collide, we update Cloth::simulate with code that checks each point mass with every primitives for 
    possible collision.
  </p>
  <p>
    <b>
      Shpere
    </b>
  </p>
  <p>
    The spring constant controls the stiffness of the cloth. With large ks, side portion of the cloth does not stick close to 
    the sphere. With small ks, cloth fit closely to the sphere.
  </p>
  <div align="middle">
    <table style="width:100%">
        <tr align="center">
            <td>
                <img src="img/p3_sphere_ks_500.png" align="middle" width="400px" />
                <figcaption>final state with ks=500 (sphere.json)</figcaption>
            </td>
            <td>
                <img src="img/p3_sphere_ks_5000.png" align="middle" width="400px" />
                <figcaption>final state with ks=5000 (sphere.json)</figcaption>
            </td>
        </tr>
        <tr align="center">
            <td>
                <img src="img/p3_sphere_ks_50000.png" align="middle" width="400px" />
                <figcaption>final state with ks=50000 (sphere.json)</figcaption>
            </td>
        </tr>
    </table>
  </div>
  <br />
  <p>
    <b>
      Plane
    </b>
  </p>
  <div align="middle">
    <table style="width:100%">
        <tr align="center">
            <td>
                <img src="img/p3_plane.png" align="middle" width="400px" />
                <figcaption>final state of (plane.json)</figcaption>
            </td>
        </tr>
    </table>
  </div>
  <br />

  <h2 align="middle">Part 4: Handling self-collisions</h2>

  <p>
    <b>
      Implementation
    </b>
  </p>
  <p>
    To handle self-collision, we implemented spatial hashing and store each point mass in 3D boxes. The size of the box is (w,h,t), where 
    w = 3 * width / num_width_points, h = 3 * height / num_height_points, t = max(w, h). For a unqiue 3D box id with coordinate (w_index,h_index,t_index),
    our hashing function returns unqiue floating point: 10000*w_index + h_index + 0.0001 * t_index. We clear and build such hash table each step of the simulation.\n
    
    For each point mass, we only need to check other point mass that are in the same 3D box for self-collision. If the distance between the checked point mass 
    and a candidate point mass is smaller than set threshold (2*thickness), We add the correction vector (vector that need to be applied to checked point mass 
    only so that they are far enough from each other) to a list and take the average of that list in the end to get final correction vector for the checked point mass.
  </p>
  <p>
    <b>
      Cloth falling process
    </b>
  </p>
  <div align="middle">
    <table style="width:100%">
        <tr align="center">
            <td>
                <img src="img/p4_self_1.png" align="middle" width="400px" />
                <figcaption>beginning of simulation (selfCollision.json)</figcaption>
            </td>
            <td>
                <img src="img/p4_self_2.png" align="middle" width="400px" />
                <figcaption>middle of simulation (selfCollision.json)</figcaption>
            </td>
        </tr>
        <tr align="center">
            <td>
                <img src="img/p4_self_3.png" align="middle" width="400px" />
                <figcaption>close to end of simulation (selfCollision.json)</figcaption>
            </td>
            <td>
              <img src="img/p4_self_4.png" align="middle" width="400px" />
              <figcaption>resting state (selfCollision.json)</figcaption>
          </td>
        </tr>
    </table>
  </div>
  <br />
  <p>
    <b>
      Varying spring constant
    </b>
  </p>
  <p>
    Spring constant changes stiffness of cloth. With small spring constant, the cloth folds many layers and has wrinkles.
    With large spring constant, the cloth maintains its shape while folding, generating less layers and wrinkles. 
  </p>
  <div align="middle">
    <table style="width:100%">
        <tr align="center">
            <td>
                <img src="img/p4_self_ks_500.png" align="middle" width="400px" />
                <figcaption>simulation with ks=500 (selfCollision.json)</figcaption>
            </td>
            <td>
                <img src="img/p4_self_ks_50000.png" align="middle" width="400px" />
                <figcaption>simulation with ks=50000 (selfCollision.json)</figcaption>
            </td>
        </tr>
    </table>
  </div>
  <br />
  <p>
    <b>
      Varying density
    </b>
  </p>
  <p>
    Density contribute to external forces, and the change in desnity will have opposite effect as spring constant. 
    With small density, the cloth floats more and folds less, resulting less layers.
    With large density, gravition pulls cloth down and create more layers and wrinkles.
  </p>
  <div align="middle">
    <table style="width:100%">
        <tr align="center">
            <td>
                <img src="img/p4_self_density_5.png" align="middle" width="400px" />
                <figcaption>simulation with density=5 (selfCollision.json)</figcaption>
            </td>
            <td>
                <img src="img/p4_self_density_50.png" align="middle" width="400px" />
                <figcaption>simulation with density=50 (selfCollision.json)</figcaption>
            </td>
        </tr>
    </table>
  </div>
  <br />
  

  <h2 align="middle">Part 5: Shaders</h2>

  <p>
    <b>
      Shader program
    </b>
  </p>
  <p>
    The shader program is designed to run graphic piplines on the GPU that changes visual effect of the surface of the modeled object. 
    Input were taken and 4-dimensional vector was outputted normally. Our project uses the vertex shader and fragment shader. 
    Vertex shaders writes position and normal values from the model space to the world space and output them. It also calculate and output final screen position of each vertices. 
    Fragment shaders take the output of vertex shaders and compute the lighting and color of each point using baycentric coordinate method and output them.
  </p>
  <br />
  <p>
    <b>
      Blinn-Phong shader
    </b>
  </p>
  <p>
    The Blinn-Phong shading model is a mathematical model that simulates lighting effect human eye/camera captures from the scene.
    It consists of three kind of shading: ambient, diffuse, and specular. Ambient shading account for environmental light with constant scaling.
    Diffuse shading account for diffusely reflected light following the angle formed from the light source and the surface normal, which is does not depend on view angle.
    Specular shading account for reflection from light source to the view angle, exihibiting as shining area on the object surface. 
  </p>
  <div align="middle">
    <table style="width:100%">
        <tr align="center">
            <td>
                <img src="img/p5_phong_ambient.png" align="middle" width="400px" />
                <figcaption>final state with only ambient shading (sphere.json)</figcaption>
            </td>
            <td>
                <img src="img/p5_phong_diffuse.png" align="middle" width="400px" />
                <figcaption>final state with only diffuse shading (sphere.json)</figcaption>
            </td>
        </tr>
        <tr align="center">
            <td>
                <img src="img/p5_phong_specular.png" align="middle" width="400px" />
                <figcaption>final state with only specular shading (sphere.json)</figcaption>
            </td>
            <td>
              <img src="img/p5_phong_all.png" align="middle" width="400px" />
              <figcaption>final state with whole Blinn-Phong shading (sphere.json)</figcaption>
          </td>
        </tr>
    </table>
  </div>
  <br />
  <p>
    <b>
      Texture mapping shader
    </b>
  </p>
  <div align="middle">
    <table style="width:100%">
        <tr align="center">
            <td>
                <img src="img/p5_texture_1.png" align="middle" width="400px" />
                <figcaption>initial state of custom texture image (sphere.json)</figcaption>
            </td>
            <td>
                <img src="img/p5_texture_2.png" align="middle" width="400px" />
                <figcaption>final state of custom texture image (sphere.json)</figcaption>
            </td>
        </tr>
    </table>
  </div>
  <br />
  <p>
    <b>
      Bump mapping and displacement mapping shader
    </b>
  </p>
  <br />
  <p>
    <b>
      Environment-mapped Reflections
    </b>
  </p>



	<h3 align="middle">Project Link</h3>

	<a href="">Link</a>

</body>

</html>